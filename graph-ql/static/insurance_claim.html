<!DOCTYPE HTML>
<html lang="en">
    <head>
		<title>Insurance | ZeniaGraph</title>
		<meta charset="utf-8" />
        <link rel="icon" type="image/x-icon" href="/static/favicon-32x32.png">
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
         
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap4.min.css">
        <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.4.1/css/responsive.bootstrap4.min.css">
        <link rel="stylesheet" href="/static/style.css"> 
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.css" integrity="sha512-8D+M+7Y6jVsEa7RD6Kv/Z7EImSpNpQllgaEIQAtqHcI0H6F4iZknRj0Nx1DCdB+TwBaS+702BGWYC0Ze2hpExQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="/static/select2/css/select2.min.css">

        
        <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" 
            crossorigin="anonymous"></script>
        <script type="text/javascript" src="/static/dev.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
       
        <script type="text/javascript" src="/static/select2/js/select2.min.js"></script>

        <script
            type="text/javascript"
            src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
        <script 
            type="text/javascript"
            src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap4.min.js"></script>
        <script
            type="text/javascript"
            src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>
        <script
            type="text/javascript"
            src="https://cdn.datatables.net/responsive/2.4.1/js/responsive.bootstrap4.min.js"></script>
         

	</head>
    
    <body>
        <style>
            .Input_fields label {
                font-size: 14px;
                margin-bottom: 0;
            }
            #outputtable_similarity_length{ display: none;}
            .Input_fields input{ height: auto;}
             
            .select2-search__field{ font-size: 13px !important;}
            .select2-results__option{
                font-size: 13px;
            }
            .select2-selection__choice{ font-size: 14px !important;}
            .select2-selection__placeholder{ font-size: 12px;}
            .input_panel .select2-selection{ height: 34.5px !important;}
            #visual_graph_model .modal-body { padding: 0;;}
            #visual_graph_model { padding:0 !important;}
            #visual_graph_model .modal-dialog{
                width: 100%;
                max-width: 95% !important;
            }
            button.close {
                margin-right: 21px;
                margin-top: 6px;
                position: absolute;
                right: -8px;
            }
            .label_bold{ font-weight: 500;}
            .filter_selectbox{
                font-size: 12px;
            }
            .filter_title{
                font-weight: bold;
            }
            .clear_filter{
                color: #0056b3;
                padding: 2px;
                font-size: 13px;
                background: none;
                border: 0;
                 
                text-decoration: underline;
            }
            .comp_box select{ width: 100%; border: 1px solid #aaa; border-radius: 4px; height:30px;}
            .comp_box input{ width: 100%; padding-left: 10px;}
            .comp_box input::placeholder{ font-size: 12px; }
            .filters_sections code{
                color: black;
                font-weight: 600;
            }
            .top_row_input_panel{
                background: #d5efff;
                padding-left: 10px;
                font-weight: bold;
                cursor: pointer;
                padding-top: 5px;
                padding-bottom: 5px;
                user-select: none;
            }
            .top_row_input_panel  i { margin-right: 15px; margin-top: 3px; transition: all 0.5s ease-out;}
            .top_row_input_panel.active i{
                transform: rotate(177deg);
                -webkit-transform: rotate(177deg);
                -moz-transform: rotate(177deg);
            }
            .top_row_reg {
                padding-top: 5px;
                padding-bottom: 5px;
                user-select: none;
                
            }
            .top_row_reg .title_row{
                margin:0;
                background: #d5efff;
                font-weight: bold;
                cursor: pointer;
                padding-top: 5px;
                padding-bottom: 5px;
                user-select: none;
            }
            .btn-similarity{
                color: #fff;
                background-color: #007bff;
                border-color: #007bff;
                font-size: 12px !important;
                width: 92%;
                display: block;
                margin-bottom: 5px;
            }
            .Input_fields input {
                height: 30px;
                margin: 1px auto;
                display: block;
            }
            .Input_fields select{
                height: 30px;
            }
            .at-tags{ text-decoration: underline !important;}
            .at-tags i{ color:#ba0373; padding-top: 5px; font-size: 23px;}
            #outputtable .spinner-border-sm {
                width: 0.7rem;
                height: 0.7rem;
            }
            .btn-similarity:focus{
                outline: none !important;
                outline-style: none !important;
                box-shadow: none !important;
            }
            .key_label {
                font-size: 13px;
                font-weight: bold;
                padding-left: 0;
            }
            .key_value {
                font-size: 13px;
                font-weight: normal;
                padding-left: 0;
                word-break: break-word;
            }
            .selected_claim_detail{ background: #f9f9f9; padding-top:5px; padding-left: 15px;}
            .btn-def .spinner-border{ display: none;} 
            .btn-def{ width: 120px;
                text-align: center;
                justify-content: center;
                display: flex;
                height: 38px;
                align-items: center;
                background: #ba0373 !important;
                border: 0;}
            .input_panel{
                padding-top: 7px;   
            }
        </style>
        {% include 'header.html' %}

        <div class="Input_fields container-fluid" style="margin-bottom:10rem; max-width:1320px;">
            <div class="row">
                <div class="col-3 mt-3">
                     
                    <!-----Classification Filters---->
                    <div class="main-row-block">
                        <div class="top_row_input_panel active" data-block="1">
                            <div class="row">
                                <div class="col-md-10">Classification Filters</div>
                                <div class="col-md-2"><i class="fa fa-chevron-up float-right"></i></div>
                            </div>
                        </div>
                        <div class="input_panel">
                            <!--Filter Section-->
                            <div class="row mb-1 filters_sections">
                                <div class="col-12">
                                    <div class="row">
                                        <div class="col-6"> <div class="col filter_title pl-0"></div></div>
                                        <div class="col-6"><a href="javascript:void(0)" class="clear_filter float-right">Clear Filter</a></div>
                                    </div>
                                </div>
                                <div class="filter_claims col-12">                                     
                                    <div class="form-group">
                                        <label><code>Claim Status</code></label>
                                        <select onchange="filterClaimsData()" class="filter_selectbox form-control" id="claimStatus" data-name="claimStatus">
                                            <option value="">Select Status</option>
                                            <option value="Pending">Pending</option>
                                            <option value="Under Review">Under Review</option>
                                            <option value="Approved">Approved</option>
                                        </select>    
                                    </div>                                     
                                    <div class="form-group">
                                        <label><code>Claim Title</code></label>
                                        <input type="text" class="form-control" id="claimTitle" name="claimTitle">
                                    </div>
                                    <div class="form-group">
                                        <label><code>Claim Status Reason</code></label>
                                        <input type="text" class="form-control" id="claimStatusReason" name="claimStatusReason">
                                    </div>  
                                    <div class="form-group">
                                        <label><code>Policy Plan Name</code></label>
                                        <select onchange="filterClaimsData()" class="filter_selectbox form-control" id="policyPlanName" data-name="policyPlanName">
                                            <option value="">Select Status</option>
                                        </select>    
                                    </div> 
                                    <div class="form-group">
                                        <label><code>Incident Type</code></label>
                                        <input type="text" class="form-control" id="incidentType" name="incidentType">
                                    </div>  
                                    <div class="form-group">
                                        <label><code>Incident Location</code></label>
                                        <input type="text" class="form-control" id="incidentLocation" name="incidentLocation">
                                    </div>
                                    <div class="form-group">
                                        <label><code>Incident Description</code></label>
                                        <input type="text" class="form-control" id="incidentDescription" name="incidentDescription">
                                    </div>  
                                </div>
                                                             
                            </div>

                            <div class="form-group mt-1">
                                <button  onclick="filterClaimsData()" class="btn btn-primary fnd_classification_submit btn-def" disabled type="button" id="fnd_classification_submit">
                                    <div class="spinner-border spinner-border-sm" role="status">
                                        <span class="sr-only">Loading...</span>
                                    </div>
                                    <span id="sbtext" class="submit_txt">Submit</span>
                                </button>
                            </div>
                        </div>
                    </div>
                     
                    <div class="top_row_reg d-none">
                        <div class="row title_row">
                            <div class="col-md-6">Selected Claim</div>
                        </div>
                        <div class="selected_claim_detail"></div>  
                    </div>
                    

                </div>
                <div class="col-9">
                    
                    <div class="output_block mt-3">
                        
                        <div class="col-md-12">
                            <div class="row">
                                <div class="col-6 pl-0">
                                    <div class="row">
                                        <div class="col-1 d-none d-heading"><a href="javascript:void(0)" class="at-tags"><i class="fa fa-arrow-left"></i></a></div>
                                        <div class="col-6"><h4 class="heading-l">All Claims:</h4></div>
                                    </div>
                                </div>
                                <div class="col-6 pl-0">
                                    <button class="btn btn-sm btn-warning showkg_Button cmnbtn float-right d-none" type="button">Show KG</button>
                                </div>          
                            </div>                       
                        </div>                       
                        <div class="all_claims_table">
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered" id="outputtable">
                                    <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col" width="2%">Checkbox</th>
                                            <th scope="col">Claim Title</th>
                                            <th scope="col" width="55%">Claim Description</th>
                                            <th scope="col" width="15%">Action</th>
                                            <th scope="col" width="15%" class="none">Person Name</th>
                                            <th scope="col" width="15%" class="none">Claim Date</th>
                                            <th scope="col" width="15%" class="none">Claim Status</th>
                                            <th scope="col" width="15%" class="none">Claim Amount</th>
                                            <th scope="col" width="15%" class="none">Incident Location</th>
                                            <th scope="col" width="15%" class="none">Incident Type</th>
                                            <th scope="col" width="15%" class="none">Incident Description</th>                                            
                                            <th scope="col" width="15%" class="none">Claim Status Reason</th>
                                            <th scope="col" width="15%" class="none">Adjuster Notes</th>    
                                            <th scope="col" width="15%" class="none">Witness Information</th>    
                                            <th scope="col" width="15%" class="none">Injury Information</th>    
                                            <th scope="col" width="15%" class="none">Policy Plan Name</th>    
                                            <th scope="col" width="15%" class="none">Vehicle</th>
                                            <th scope="col" width="15%" class="none">License Plate</th>
                                            <th scope="col" width="15%" class="none">Premium Amount</th>
                                            <th scope="col" width="15%" class="none">CoverageStartDate</th>
                                            <th scope="col" width="15%" class="none">CoverageEndDate</th>        
                                        </tr>
                                    </thead>
                                    <tbody class="tbody_class"></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="simialrity_claims_table d-none">
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered" id="outputtable_similarity">
                                    <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">Claim Title</th>
                                            <th scope="col">Similarity Score</th>
                                            <th scope="col">Claim Description</th>
                                            <th scope="col" width="15%" class="none">Person Name</th>
                                            <th scope="col" width="15%" class="none">Claim Date</th>
                                            <th scope="col" width="15%" class="none">Claim Status</th>
                                            <th scope="col" width="15%" class="none">Claim Amount</th>
                                            <th scope="col" width="15%" class="none">Incident Location</th>
                                            <th scope="col" width="15%" class="none">Incident Type</th>
                                            <th scope="col" width="15%" class="none">Incident Description</th>                                            
                                            <th scope="col" width="15%" class="none">Claim Status Reason</th>
                                            <th scope="col" width="15%" class="none">Adjuster Notes</th>    
                                            <th scope="col" width="15%" class="none">Witness Information</th>    
                                            <th scope="col" width="15%" class="none">Injury Information</th>    
                                            <th scope="col" width="15%" class="none">Policy Plan Name</th>    
                                            <th scope="col" width="15%" class="none">Vehicle</th>
                                            <th scope="col" width="15%" class="none">License Plate</th>
                                            <th scope="col" width="15%" class="none">Premium Amount</th>
                                            <th scope="col" width="15%" class="none">CoverageStartDate</th>
                                            <th scope="col" width="15%" class="none">CoverageEndDate</th>                                             
                                        </tr>
                                    </thead>
                                    <tbody class="tbody_class"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="error_msg text-danger" style="display:none">
                        No Result Found
                    </div>
                </div>
            </div>
        </div>

    </body>

 
    <script>
        var global_data = []
        var frameworkUrl = "";
        var $outputTableSimilarity;         
        var policyPlans  = []
        $( document ).ready(function() {
            
            getAllResults();

            $('.clear_filter').click(function(){
                clearFilter()
            })

            $('#claimTitle, #claimStatusReason, #incidentType, #incidentLocation, #incidentDescription').keyup(function(){
                let claimTitle = $('#claimTitle').val()
                let claimStatusReason= $('#claimStatusReason').val()
                let incidentType= $('#incidentType').val()
                let incidentLocation= $('#incidentLocation').val()
                let incidentDescription = $('#incidentDescription').val() 
                if(claimTitle!="" || claimStatusReason!="" || incidentType!="" || incidentLocation!="" || incidentDescription!=""){
                     $('.fnd_classification_submit').attr('disabled',false)
                     $('.fnd_classification_submit').find('.spinner-border').hide()
                }
             })

            $('.at-tags').click(function(){
                $('.all_claims_table').removeClass('d-none')
                $('.simialrity_claims_table').addClass('d-none')
                $('.heading-l').text('All Claims')
                $('.d-heading').addClass('d-none')
                $('.spinner-border').addClass('d-none')
                $('.sbtext').show();

                showSelectedClaim('')

                $('.chk_input_ticker').prop('checked', false)
                $('.showkg_Button').addClass('d-none')

                $('.main-row-block').removeClass('d-none')
            })

            $(document).on('click', '.llm_similarity_btn', function(e){
                 
                $(this).find('.sbtext').hide();
                $(this).find('.spinner-border').removeClass('d-none');

                let claimId  = $(this).data('id')     
                var settings = {
                    "url": graphQLEndpoint,
                    "method": "POST",
                    "timeout": 0,
                    "headers": {
                      "Content-Type": "application/json"
                    },
                    "data": JSON.stringify({
                      query: "query getSimilarClaims($claimId: String!, $vector_field_name: String){\r\n    getSimilarClaims(claimId: $claimId, vector_field_name: $vector_field_name)\r\n    {\r\n        claims\r\n        graph_url\r\n         \r\n    } \r\n}",
                      variables: {"claimId":claimId}
                    })
                };
                  
                $.ajax(settings).done(function (response) {
                    var allClaims = response.data.getSimilarClaims.claims
                    $outputTableSimilarity.clear()
                    if(allClaims.length > 0){
                        $.each(allClaims, function(i, item) {
                            InsertSimilarityDataTable(item, i);
                        });
                        frameworkUrl = response.data.getSimilarClaims.graph_url
                        $('.showkg_Button').removeClass('d-none')
                    }else{
                        frameworkUrl = ""
                        $('.showkg_Button').addClass('d-none')
                    }
                    $outputTableSimilarity.draw(true).columns.adjust().responsive.recalc();
                    $('.all_claims_table').addClass('d-none')
                    $('.simialrity_claims_table').removeClass('d-none')
                    $('.heading-l').text('Similar Claims')
                    $('.d-heading').removeClass('d-none')
                    showSelectedClaim(claimId)

                    $('.main-row-block').addClass('d-none')
                });

            })

            $(document).on('click', '.graph_similarity_btn', function(e){
                 
                $(this).find('.sbtext').hide();
                $(this).find('.spinner-border').removeClass('d-none');

                let claimId  = $(this).data('id')     
                var settings = {
                    "url": graphQLEndpoint,
                    "method": "POST",
                    "timeout": 0,
                    "headers": {
                      "Content-Type": "application/json"
                    },
                    "data": JSON.stringify({
                        query: "query getSimilarClaimsByGraph($claimId: String!){\r\n    getSimilarClaimsByGraph(claimId: $claimId)\r\n    {\r\n        claims\r\n        graph_url\r\n         \r\n    } \r\n}",
                        variables: {"claimId":claimId}
                    })
                };
                  
                $.ajax(settings).done(function (response) {
                    var allClaims = response.data.getSimilarClaimsByGraph.claims
                    $outputTableSimilarity.clear()
                    if(allClaims.length > 0){
                        $.each(allClaims, function(i, item) {
                            InsertSimilarityDataTable(item, i);
                        });
                        frameworkUrl = response.data.getSimilarClaimsByGraph.graph_url
                        $('.showkg_Button').removeClass('d-none')
                    }else{
                        frameworkUrl = ""
                        $('.showkg_Button').addClass('d-none')  
                    }
                    $outputTableSimilarity.draw(true).columns.adjust().responsive.recalc();
                    $('.all_claims_table').addClass('d-none')
                    $('.simialrity_claims_table').removeClass('d-none')
                    $('.heading-l').text('Similar Claims')
                    $('.d-heading').removeClass('d-none')
                    showSelectedClaim(claimId)

                    $('.main-row-block').addClass('d-none')
                });

            })

            $('.top_row_input_panel').click(function(){
                let block = $(this).attr('data-block')
                let $parent = $(this).parents('.main-row-block')
                if(block=="1"){
                    
                    if($(this).hasClass('active')){
                        $($parent).find('.input_panel').addClass('d-none')
                        $(this).removeClass('active') 
                    }else{
                        $($parent).find('.input_panel').removeClass('d-none')
                        $(this).addClass('active') 
                    }
                }
                if(block=="2"){
                    if($(this).hasClass('active')){
                        $($parent).find('.input_panel').addClass('d-none')
                        $(this).removeClass('active') 
                    }else{
                        $($parent).find('.input_panel').removeClass('d-none')
                        $(this).addClass('active') 
                    }
                }
                 
                 
            })
 

            $('.showkg_Button').click(function(){
                window.open(visualGraphShowKG(frameworkUrl,'full'))
            });
            $fdataTable = $('#outputtable').DataTable({
                "iDisplayLength" : 10,
                "responsive":true,
                "bAutoWidth": false,
                
                "serverSide": false,
                "processing": true,
                "ordering": false,
                "drawCallback": function( settings ) {
                }
            });

            $outputTableSimilarity = $('#outputtable_similarity').DataTable({
                "iDisplayLength" : 10,
                "responsive":true,
                "bAutoWidth": false,
                "serverSide": false,
                "processing": true,
                "ordering": false,
                "drawCallback": function( settings ) {
                }
            });

             
            
            $('#submitbutton').click(function(){
                $('.output_results').hide()
                $('.sbtext').hide();
                $('.error_msg').hide();
                $(this).find('.spinner-border').show();
                
                //request payload
                var requestPayload = {
                    name : $.trim($('#company_list').val()),
                    similar_source : $('input[name="similar_source"]:checked').val(),
                    top_k: parseInt($('#top_k').val())
                }   
                getResults(requestPayload)
            })

            $(document).on('select2:open','.select2_company_list',() => {
                $('.select2-search--dropdown').find('.select2-search__field')[0].focus()
            });
 
              
            $(document).on('change','.chk_input_ticker',function(){
                let claimId = $(this).data('id')
                generateConstructQuery()
            })

             
 
        });
        function getAllResults(payload){
            var settings = {
                "url": graphQLEndpoint,
                "method": "POST",
                "timeout": 0,
                "headers": {
                    "Content-Type": "application/json"
                },
                "data": JSON.stringify({
                    query: "query callRedisEnpoints($method: String!,$input: JSON ){\r\n    callRedisEnpoints(method:$method,input:$input){\r\n         records\r\n    }\r\n}",
                    variables: { "method": "get-all-claims", "input": {} }
                })
            };
              
            $.ajax(settings).done(function (response) {
                //console.log(response); 
                response = response.data.callRedisEnpoints
                if(response.records.length > 0){
                    global_data =  response.records;
                    $fdataTable.clear();
                    $.each(response.records, function(i, item) {
                        InsertDataTable(item, i);
                        if(policyPlans.indexOf(item.policyPlanName) === -1) {
                            policyPlans.push(item.policyPlanName)
                        }
                    });  
                    $fdataTable.draw(true).columns.adjust().responsive.recalc();
                    
                    addValuesInPlanBox(policyPlans)

                }else{
                    $('.error_msg').show();
                }
              });
        }
        
         
        function checkBtnStaus(){
            var query = $.trim($('#company_list').val())
            //var source = $('input[name="source_type"]:checked').length;
            var simlarSource = $('input[name="similar_source"]:checked').length;
                         
            if(query!="" && simlarSource > 0){
                $('#submitbutton').attr('disabled', false)
            }else{
                $('#submitbutton').attr('disabled', true)
            }
        }
        
        function openVisualGraph(){
            $('#visual_graph_model').modal({
                keyboard: false,
                show:true,
                backdrop:"static"
            }) 
        }
        
          
        function onlyUnique(value, index, array) {
            return array.indexOf(value) === index;
        }

        function InsertDataTable(item, i){
            let inputCheckbox  = `<input type="checkbox" name="chk_input_ticker" class="chk_input_ticker" data-id="${item.claimID}">`
            
            let act_buttons = `<div class="similarity_actions">
                <button data-id="${item.claimID}" class="btn btn-primary btn-sm btn-similarity llm_similarity_btn">
                    <div class="spinner-border spinner-border-sm d-none" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                    <span class="sbtext">LLM Similarity</span>                        
                </button> 
                <button data-id="${item.claimID}" class="btn btn-primary btn-sm btn-similarity graph_similarity_btn">
                    <div class="spinner-border spinner-border-sm d-none" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                    <span class="sbtext">Graph Similarity</span>                        
                </button>
            </div>`
            i = i+1
            let encodedUri = encodeURIComponent(`http://insurance.org/claim/${encodeURIComponent(item.claimID)}`);
            let claimTitle_uri = `<a href="${visualGraphShowKG(graph_db_visual_url+'/graphs-visualizations?uri='+encodedUri,"single")}" target="_blank">${item.claimTitle}</a>`

            $fdataTable.row.add([
                i,
                inputCheckbox,    
                claimTitle_uri,
                item.claimDescription,
                act_buttons,
                item.personName,
                item.claimDate,
                item.claimStatus,
                item.claimAmount,
                item.incidentLocation,
                item.incidentType,
                item.incidentDescription,
                item.claimStatusReason,
                item.adjusterNotes,
                item.witnessInformation,
                item.injuryInformation,
                item.policyPlanName,
                item.vehicle,
                item.licensePlate,
                item.premiumAmount,
                item.coverageStartDate,
                item.coverageEndDate

            ]);    
            
             
        }
        
        

        function showkgbuttonMode(status){
            if(status){
                $('.showkg_Button').removeAttr('disabled')
                $('.showkg_Button').removeAttr('data-toggle')
                $('.showkg_Button').removeAttr('title')
                $('.showkg_Button').removeAttr('data-original-title')
                $('[data-toggle="tooltip"]').tooltip()
            }else{
                $('.showkg_Button').attr('disabled', true)
                $('.showkg_Button').attr('data-toggle',"tooltip")
                $('.showkg_Button').attr('title', "Please select companies")
                $('.showkg_Button').attr('data-original-title', "Please select companies")
                $('[data-toggle="tooltip"]').tooltip()
            }
        }

         

        function showKgIframe(payload){
            var settings = {
                "url": graphQLEndpoint,
                "method": "POST",
                "timeout": 0,
                "headers": {
                "Content-Type": "application/json"
                },
                "data": JSON.stringify({
                query: "query showGraphDbKg($company_list: [ShowkgRequest!])\r\n{\r\n    showGraphDbKg(company_list: $company_list)\r\n    {\r\n        graph_url\r\n    } \r\n}",
                variables: payload
                })
            };
            
            $.ajax(settings).done(function (response) {
                if(response.data.showGraphDbKg.length){
                    var graph_url = response.data.showGraphDbKg[0].graph_url    
                    window. open(visualGraphShowKG(graph_url,'full'));
                    
                }
            });
        }

        
       
        function InsertSimilarityDataTable(item, i){
            i = i+1

            let encodedUri = encodeURIComponent(`http://insurance.org/claim/${encodeURIComponent(item.claimID)}`);
            let claimTitle_uri = `<a href="${visualGraphShowKG(graph_db_visual_url+'/graphs-visualizations?uri='+encodedUri,"single")}" target="_blank">${item.claimTitle}</a>`
            $outputTableSimilarity.row.add([
                i,
                claimTitle_uri,
                item.vector_score,
                item.claimDescription,
                item.personName,
                item.claimDate,
                item.claimStatus,
                item.claimAmount,
                item.incidentLocation,
                item.incidentType,
                item.incidentDescription,
                item.claimStatusReason,
                item.adjusterNotes,
                item.witnessInformation,
                item.injuryInformation,
                item.policyPlanName,
                item.vehicle,
                item.licensePlate,
                item.premiumAmount,
                item.coverageStartDate,
                item.coverageEndDate                
            ]);  
        }
        function showSelectedClaim(claimId){
            
            if(claimId){
                let matchedClaim = {} 
                $.each(global_data, function(i, item) {
                    if(item.claimID == claimId){
                        matchedClaim = item
                    }
                })
                
                $('.selected_claim_detail').html('')
                if(matchedClaim){
                    $.each(matchedClaim, function(key, value) {
                        if(!key.includes(["payload"])) {
                            $('.selected_claim_detail').append(`
                                <div class="">
                                    <div class="col key_label">${key}</div>
                                    <div class="col key_value">${value!=""?value:"-"}</div>
                                </div>  
                            `) 
                        }
                    })
                } 
                
                $('.top_row_reg').removeClass('d-none')
            }else{
                $('.top_row_reg').addClass('d-none')  
            }
        }

        function generateConstructQuery(){
            
            var uris = []
            var values_uri = "";
            $('.chk_input_ticker').each(function(key,item){
                 
                if($(item).is(':checked')){
                    let claimId = $(item).data('id')
                    uris.push(`<http://insurance.org/claim/${claimId}>`)
                    values_uri += ` (<http://insurance.org/claim/${claimId}>) `
                }
            })
            uris = uris.join(',');
            query = `
                PREFIX foaf: <http://xmlns.com/foaf/0.1/> 
                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
                PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
                PREFIX vcard: <http://www.w3.org/2006/vcard/ns#> 
                PREFIX : <http://example.org/insurance#>
                
                CONSTRUCT { 
                    ?claim a ?p . 
                }
                WHERE {
                    VALUES (?link) { ${values_uri} } 
                    bind(?link as ?claim) 
                    ?claim a ?p . FILTER (?claim IN (${uris})) 
                }`
            
            frameworkUrl = `${graph_db_visual_url}/graphs-visualizations?query=${encodeURIComponent(query)}&sameAs&inference`
            $('.showkg_Button').removeClass('d-none')
            
        }
        
        function addValuesInPlanBox(data){
            $('#policyPlanName').empty().append('<option value="">Select Plan</option>')
            for(let i =0 ; i  < data.length; i++){
                $('#policyPlanName').append(`<option value="${data[i]}">${data[i]}</option>`)
            } 
        }

        function filterClaimsData(){
            $('.showkg_Button').addClass('d-none')
            let claimStatus  = $('#claimStatus').val()
            let claimTitle = $('#claimTitle').val()
            let claimStatusReason= $('#claimStatusReason').val()
            let policyPlanName= $('#policyPlanName').val()
            let incidentType= $('#incidentType').val()
            let incidentLocation= $('#incidentLocation').val()
            let incidentDescription = $('#incidentDescription').val() 
             
            if( $.trim(claimStatus)=="" && 
                $.trim(policyPlanName)=="" && 
                $.trim(claimTitle)=="" && 
                $.trim(claimStatusReason)=="" && $.trim(incidentType)=="" && $.trim(incidentLocation)=="" &&
                $.trim(incidentDescription)==""){
                clearFilter()
                return;
            }
 
            let filterRecords = global_data.filter(function(value, index){
                 
                let isReturnMatched = true
                let filterStates = {
                    "claimStatus":{ "value": false, "isMatched":false},
                    "claimTitle":{ "value": false, "isMatched":false},
                    "claimStatusReason":{ "value": false, "isMatched":false},
                    "policyPlanName":{ "value": false, "isMatched":false},
                    "incidentType":{ "value": false, "isMatched":false},
                    "incidentLocation":{ "value": false, "isMatched":false},
                    "incidentDescription":{ "value": false, "isMatched":false}
                }
                if($.trim(claimStatus)!=""){
                    filterStates.claimStatus.value = true
                    if(value.claimStatus == claimStatus){
                        filterStates.claimStatus.isMatched = true
                    }
                    /*for(let i = 0; i < category.length; i++){
                        if(value.category == category[i]){
                            filterStates.category.isMatched = true
                        }
                    }*/
                }
                 
                if(claimTitle!=""){
                    filterStates.claimTitle.value = true
                    claimTitle = claimTitle.toString().toLowerCase()
                    if(value.claimTitle!=""){
                        let loopClaimTitle = value.claimTitle.toString().toLowerCase()                                                
                        if(loopClaimTitle.includes(claimTitle)){
                            filterStates.claimTitle.isMatched = true
                        }                        
                    }
                }

                if(claimStatusReason!=""){
                    filterStates.claimStatusReason.value = true
                    claimStatusReason = claimStatusReason.toString().toLowerCase()
                    if(value.claimStatusReason!=""){
                        let loopclaimStatusReason = value.claimStatusReason.toString().toLowerCase()                                                
                        if(loopclaimStatusReason.includes(claimStatusReason)){
                            filterStates.claimStatusReason.isMatched = true
                        }                        
                    }
                }
                if($.trim(policyPlanName)!=""){
                    filterStates.policyPlanName.value = true
                    if(value.policyPlanName == policyPlanName){
                        filterStates.policyPlanName.isMatched = true
                    }
                    /*for(let i = 0; i < category.length; i++){
                        if(value.category == category[i]){
                            filterStates.category.isMatched = true
                        }
                    }*/
                }

                if(incidentType!=""){
                    filterStates.incidentType.value = true
                    incidentType = incidentType.toString().toLowerCase()
                    if(value.incidentType!=""){
                        let loopincidentType = value.incidentType.toString().toLowerCase()                                                
                        if(loopincidentType.includes(incidentType)){
                            filterStates.incidentType.isMatched = true
                        }                        
                    }
                }
                if(incidentLocation!=""){
                    filterStates.incidentLocation.value = true
                    incidentLocation = incidentLocation.toString().toLowerCase()
                    if(value.incidentLocation!=""){
                        let loopincidentLocation = value.incidentLocation.toString().toLowerCase()                                                
                        if(loopincidentLocation.includes(incidentLocation)){
                            filterStates.incidentLocation.isMatched = true
                        }                        
                    }
                }
                if(incidentDescription!=""){
                    filterStates.incidentDescription.value = true
                    incidentDescription = incidentDescription.toString().toLowerCase()
                    if(value.incidentDescription!=""){
                        let loopIncidentDescription = value.incidentDescription.toString().toLowerCase()                                                
                        if(loopIncidentDescription.includes(incidentDescription)){
                            filterStates.incidentDescription.isMatched = true
                        }                        
                    }
                }

                //calculate matched status
                isReturnMatched = getIncludeStatus(filterStates)               
                 
                return isReturnMatched
            })
            
            $fdataTable.clear()    
            $.each(filterRecords, function(i, item) {
                InsertDataTable(item, i)   
            });
            $fdataTable.draw(true).columns.adjust().responsive.recalc();
        }

        function clearFilter(){
            $(".filter_selectbox, .filters_sections input").val("");  
            $fdataTable.clear()    
            $.each(global_data, function(i, item) {
                InsertDataTable(item, i)   
            });
            $fdataTable.draw(true).columns.adjust().responsive.recalc();
            $('.showkg_Button').addClass('d-none')
        }
        
         

        function getIncludeStatus(filterStates) {
            console.log(filterStates)
            const conditions = [
                ['claimStatus', 'claimTitle', 'claimStatusReason','policyPlanName','incidentDescription','incidentLocation','incidentType'].every(key => !filterStates[key].value || filterStates[key].isMatched)
            ];
        
            return conditions.every(condition => condition);
        }
        
    </script>
</html>