<!DOCTYPE HTML>
<html lang="en">
    <head>
        <link rel="icon" type="image/x-icon" href="/static/favicon-32x32.png">
		<title>Classification | ZeniaGraph</title>
		<meta charset="utf-8" />
        
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
         
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="/static/style.css"> 
        <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap4.min.css">
        <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.4.1/css/responsive.bootstrap4.min.css">
        <link rel="stylesheet" href="/static/select2/css/select2.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" 
            crossorigin="anonymous"></script>
        <script src="/static/dev.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
        <script
            type="text/javascript"
            src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
        <script 
            type="text/javascript"
            src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap4.min.js"></script>
        <script
            type="text/javascript"
            src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>
        <script
            type="text/javascript"
            src="https://cdn.datatables.net/responsive/2.4.1/js/responsive.bootstrap4.min.js"></script>
        <script
            type="text/javascript"
            src="/static/select2/js/select2.min.js"></script>
         
        
	</head>
    
    <body>
        <style>
            .view_cnt_info, .view_cnt_redis{
                font-size: 12px;
                height: 22px;
                line-height: 7px;
            }
            #events_item_block { user-select: none;}
            .contact_body strong{
                color:Red;
                font-size:18px;
            }
            .view_cnt_info{
                font-size: 12px;
                height: 22px;
                line-height: 7px;
            }
            .Input_fields input{ height: auto;}
            .cmnbtn{ background-color: #ffc107;
                border-color: #ffc107;
                color: #000; font-size: 14px;
                padding: 5px 3px; display: none;}
            .cmnbtn:hover, .cmnbtn:active, .cmnbtn:focus{
                background-color: #ffc107 !important;   
                color: #000;
                border-color: #ffc107 !important;
            }
            .showSimilar_Button { width: 160px !important; height:32px;}
            .showSimilar_Button:disabled{ width: 160px !important; height:32px; background-color: #b6420c;   
                color: #fff;
                border-color: #b6420c;}
            iframe { border:0;}
            .heading-l{ font-size: 18px;}
            #visual_graph_model .modal-body { padding: 0;;}
            #visual_graph_model { padding:0 !important;}
            #visual_graph_model .modal-dialog{
                width: 100%;
                max-width: 95% !important;
            }
            button.close {
                margin-right: 21px;
                margin-top: 6px;
                position: absolute;
                right: -8px;
            }
            .showSimilar_Button .spinner-border{ display: none; margin: 0 auto}
            .select2-container{
                width: 100% !important;
            }
            .select2-search__field{ font-size: 13px !important;}
            .select2-results__option{
                font-size: 13px;
            }
            .select2-selection__choice{ font-size: 14px !important;}
            #query{ font-size: 14px;}
            .select2-container--default .select2-selection--single {
                background-color: #fff;
                border: 1px solid #aaa;
                border-radius: 4px;
                height: 32px;
            }
            .select2-selection__placeholder{ font-size: 13px;}
            .btn-default{
                color: #333;
                background-color: #fff;
                border-color: #ccc;
            }
            #contactViewModal .close{ padding:0;}
            .filter_selectbox{
                width:125px;
                font-size: 13px;
            }
            .filter_title{
                font-weight: bold;
            }
            .clear_filter{
                color: #0056b3;
                padding: 2px;
                font-size: 13px;
                background: none;
                border: 0;
                 
                text-decoration: underline;
            }
            .comp_box select{ width: 100%; border: 1px solid #aaa; border-radius: 4px; height:30px;}
            .comp_box input{ width: 100%; padding-left: 10px;}
            .comp_box input::placeholder{ font-size: 12px; }
            .filters_sections code{
                color: black;
                font-weight: 600;
            }
            .top_row_input_panel{
                background: #d5efff;
                padding-left: 10px;
                font-weight: bold;
                cursor: pointer;
                padding-top: 5px;
                padding-bottom: 5px;
                user-select: none;
            }
            .top_row_input_panel  i { margin-right: 15px; margin-top: 3px; transition: all 0.5s ease-out;}
            .top_row_input_panel.active i{
                transform: rotate(177deg);
                -webkit-transform: rotate(177deg);
                -moz-transform: rotate(177deg);
            }
            
        </style>
        
        {% include 'header.html' %}

        <div class="Input_fields container-fluid" style="margin-bottom:10rem; max-width:1320px;">
            <div class="row">
                <div class="col-4 mt-3">
                    <div class="top_row_input_panel active" data-name="query">
                        <div class="row">
                            <div class="col-md-6">Query</div>
                            <div class="col-md-6"><i class="fa fa-chevron-up float-right"></i></div>
                        </div>
                    </div>
                    <div class="input_panel">
                        <div class="form-group">
                            <div class="row mb-3">
                                <div class="col-6">
                                    <label for="exampleInputEmail1">Query Text *</label>
                                </div>
                                <div class="col-6">
                                    <div class="toggle_uid d-flex">
                                        <span class="tog_item tog_basic active" data-tab="basic">Basic</span>
                                        <span class="tog_item tog_advance" data-tab="advance">Advance</span>
                                    </div>
                                </div>
                            </div> 
                            <div class="basic_text_ui">
                                <div class="classify_heading">ACTIVE:</div>
                                <div class="ad_form_items">
                                    <div class="ad_input_group">
                                        <div class="ad_input_text ad_item"><input type="text" name="act_opearting_years"></div>
                                        <div class="ad_input_label ad_item"><code>years of operating business</code></div>
                                    </div>
                                    <div class="ad_input_group">
                                        <div class="ad_input_text ad_item"><input type="text" name="act_employees"></div>
                                        <div class="ad_input_label ad_item"><code>employees</code></div>
                                    </div>
                                    <div class="ad_input_group">
                                        <div class="ad_input_text ad_item"><input type="text" name="act_growth_quarterly"></div>
                                        <div class="ad_input_label ad_item"><code>growth quarterly</code></div>
                                    </div>
                                    <div class="ad_input_group">
                                        <div class="ad_input_text ad_item"><input type="text" name="act_growth_yearly"></div>
                                        <div class="ad_input_label ad_item"><code>growth yearly</code></div>
                                    </div>
                                </div>
                                <div class="classify_heading">INACTIVE:</div>
                                <div class="ad_form_items">
                                    <div class="ad_input_group">
                                        <div class="ad_input_text ad_item"><input type="text" name="int_opearting_years"></div>
                                        <div class="ad_input_label ad_item"><code>years of operating business</code></div>
                                    </div>
                                    <div class="ad_input_group">
                                        <div class="ad_input_text ad_item"><input type="text" name="int_employees"></div>
                                        <div class="ad_input_label ad_item"><code>employees</code></div>
                                    </div>
                                    <div class="ad_input_group">
                                        <div class="ad_input_text ad_item"><input type="text" name="int_growth_quarterly"></div>
                                        <div class="ad_input_label ad_item"><code>growth quarterly</code></div>
                                    </div>
                                    <div class="ad_input_group">
                                        <div class="ad_input_text ad_item"><input type="text" name="int_growth_yearly"></div>
                                        <div class="ad_input_label ad_item"><code>growth yearly</code></div>
                                    </div>
                                </div>
                                <div class="classify_heading">OTHERS:</div>
                                <div class="ad_form_items">
                                    <div class="ad_input_group">
                                        <div class="ad_input_label ad_item"><code>Any other leads which are not Active or Inactive</code></div>
                                    </div>
                                </div>
                            </div>
                            <div class="advance_text_ui d-none">
                                <textarea rows="8" class="form-control"  name="query" id="query" onkeyup="checkBtnStaus()"></textarea>
                            </div>
                            
                        </div>
                        <div class="form-group">
                            <label for="exampleInputEmail1">Company List </label>
                            <select id="company_list" class="js-data-example-ajax select2_company_list" onchange="checkBtnStaus()" name="company_list[]" multiple="multiple"></select>

                        </div>
                        <!--<div class="form-group">
                            <label for="exampleInputEmail1">Sources *</span></label>
                            <div class="form-check">
                                <input checked="checked" class="form-check-input" type="checkbox" value="linkedin" id="linkedin" name="sources[linkedin]" onchange="checkBtnStaus()">
                                <label class="form-check-label" for="linkedin">
                                    LinkedIn
                                </label>
                            </div>
                            <div class="form-check">
                                <input checked="checked" class="form-check-input" type="checkbox" value="dbpedia" id="dbpedia" name="sources[dbpedia]" onchange="checkBtnStaus()">
                                <label class="form-check-label" for="dbpedia">
                                    DBPedia
                                </label>
                            </div>
                            <div class="form-check">
                                <input checked="checked" class="form-check-input" type="checkbox" value="zoominfo" id="zoominfo" name="sources[zoominfo]" onchange="checkBtnStaus()">
                                <label class="form-check-label" for="zoominfo">
                                    ZoomInfo
                                </label>
                            </div>
                        </div>-->
                        
                        <div class="form-group">
                            <label for="exampleInputEmail1" style="width: 100%;">Select Code</label>
                            <div class="form-check-inline">
                                <input class="form-check-input" type="radio" value="sic_code" id="sicCode" name="business_codes" onchange="checkBtnStaus()">
                                <label class="form-check-label" for="sicCode">
                                    SIC Code
                                </label>
                            </div>
                            <div class="form-check-inline">
                                <input class="form-check-input" type="radio" value="naics_code" id="nicCode" name="business_codes" onchange="checkBtnStaus()">
                                <label class="form-check-label" for="nicCode">
                                    NAICS Code
                                </label>
                            </div>
                            <div class="form-check-inline">
                                <input checked class="form-check-input" type="radio" value="none_code" id="none_code" name="business_codes">
                                <label class="form-check-label" for="none_code">
                                    None
                                </label>
                            </div>
                        </div>
                        <div class="form-group d-none company_code_box">
                            <select class="js-data-example-ajax select_code_list" name="company_code"></select>
                        </div>
                        
                        <!--event list-->
                        <div id="events_wrapper">
                            <label style="width: 100%;" for="exampleInputEmail1" class="label_bold">Events *</label>
                            <div class="col-12" id="events_item_block"></div>
                        </div>
                         
                        <div class="form-group mt-4">
                            <button class="btn btn-primary" type="button" id="submitbutton">
                                <div class="spinner-border spinner-border-sm" role="status">
                                    <span class="sr-only">Loading...</span>
                                </div>
                                <span id="sbtext">Submit</span>
                            </button>
                        </div>
                    </div>

                    <div class="top_row_input_panel mt-3 d-none" data-name="filter">
                        <div class="row">
                            <div class="col-md-6">Filters</div>
                            <div class="col-md-6"><i class="fa fa-chevron-up float-right"></i></div>
                        </div>
                    </div>
                    <div class="row mb-3 mt-2 filters_sections d-none">
                        <div class="col-12">
                            <div class="row">
                                <div class="col-6"> <div class="col filter_title pl-0"></div></div>
                                <div class="col-6"><a href="javascript:void(0)" class="clear_filter float-right">Clear Filter</a></div>
                            </div>
                        </div>
                        <div class="col-12 mt-2">
                            <code>Industry</code>
                            <select class="filter_selectbox" id="industry_filter" data-name="industry" multiple="multiple"></select>    
                        </div>
                        <div class="col-12 mt-2">
                            <code>Headquarters</code>
                            <select class="filter_selectbox" id="headquarters_filter" data-name="headquarters" multiple="multiple"></select>    
                        </div>
                        <div class="col-12 comp_box mt-2">
                            <code style="display:block">Opearting Years</code>
                            <select class="filter_selectbox" id="operating_years_filter" data-name="operating_years">
                                <option value="">Select</option>
                            </select>
                            <div class="mt-2 input_single d-none">
                                <input type="number" placeholder="enter opearting years" class="num_validate">
                            </div>
                            <div class="col-12 mt-2 input_between d-none">
                                <div class="row">
                                    <div class="col-6 pl-0"><input type="number" placeholder="from" class="num_validate from_num"></div>
                                    <div class="col-6 pr-0"><input type="number" placeholder="to" class="num_validate to_num"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 comp_box mt-2">
                            <code style="display:block">Employees</code>
                            <select class="filter_selectbox" id="no_of_employees_filter" data-name="no_of_employees">
                                <option value="">Select</option>
                            </select>
                            <div class="mt-2 input_single d-none">
                                <input type="number" placeholder="enter employees" class="num_validate">
                            </div>
                            <div class="col-12 mt-2 input_between d-none">
                                <div class="row">
                                    <div class="col-6 pl-0"><input type="number" placeholder="from" class="num_validate from_num"></div>
                                    <div class="col-6 pr-0"><input type="number" placeholder="to" class="num_validate to_num"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 comp_box mt-2">
                            <code>Quarterly Growth</code>
                            <select class="filter_selectbox" id="quarterly_growth_filter" data-name="quarterly_growth">
                                <option value="">Select</option>
                            </select>
                            <div class="mt-2 input_single d-none">
                                <input type="number" placeholder="enter growth" class="num_validate">
                            </div>
                            <div class="col-12 mt-2 input_between d-none">
                                <div class="row">
                                    <div class="col-6 pl-0"><input type="number" placeholder="from" class="num_validate from_num"></div>
                                    <div class="col-6 pr-0"><input type="number" placeholder="to" class="num_validate to_num"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 comp_box mt-2">
                            <code>Annual Growth</code>
                            <select class="filter_selectbox" id="annual_growth_filter" data-name="annual_growth">
                                <option value="">Select</option>
                            </select>
                            <div class="mt-2 input_single d-none">
                                <input type="number" placeholder="enter grwoth" class="num_validate">
                            </div>
                            <div class="col-12 mt-2 input_between d-none">
                                <div class="row">
                                    <div class="col-6 pl-0"><input type="number" placeholder="from" class="num_validate from_num"></div>
                                    <div class="col-6 pr-0"><input type="number" placeholder="to" class="num_validate to_num"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 comp_box mt-2">
                            <code>Status</code>
                            <select class="filter_selectbox" id="status_filter" data-name="status">
                                <option value="">Select</option>
                                <option value="ACTIVE">ACTIVE</option>
                                <option value="INACTIVE">INACTIVE</option>
                                <option value="OTHERS">OTHERS</option>
                                <option value="NOT_CLASSIFIED">NOT_CLASSIFIED</option>
                            </select>
                        </div>
                    </div> 

                </div>
                <div class="col-8">
                    <div class="output_block container mt-3">
                        
                        <div class="output_results">
                            <div class="col-12">
                                <div class="row">
                                    <div class="col-5 pl-0"><h4 class="heading-l">Show Classified Companies:</h4></div>
                                    <div class="col-7 pl-0">
                                        <button data-toggle="tooltip" title="Please select companies" disabled class="btn btn-sm btn-warning showkg_Button cmnbtn float-right" type="button">Show KG</button>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered" id="outputtable">
                                    <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col"><input type="checkbox" class="chk_all_boxes"></th>
                                            <th scope="col">Name</th>
                                            <th scope="col">Industry</th>
                                            <th scope="col" class="none">Headquarters</th>
                                            <th scope="col">Status</th>
                                            <th scope="col">Contact</th>
                                            <th scope="col" class="none">Operating Years</th>
                                            <th scope="col" class="none">Employees</th>
                                            <th scope="col" class="none">Growth quarterly</th>
                                            <th scope="col" class="none">Growth yearly</th>
                                        </tr>
                                    </thead>
                                    <tbody class="tbody_class"></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="error_msg text-danger" style="display:none">
                            No Result Found
                        </div>
                    </div>
                </div>
            </div>
        </div>
 

        <div class="modal fade" id="contactViewModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
              <div class="modal-content ">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">View Contact of <span class="pop_info_comp"></span></h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                    <table class="table table-striped" id="contacts_table">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">First Name</th>
                                <th scope="col">Last Name</th>
                                <th scope="col">Source</th>
                                <th scope="col">Occupation</th>
                                <th scope="col" class="none">Description</th>
                                <th scope="col">Social Url</th>
                            </tr>
                        </thead>
                        <tbody class="contact_body"></tbody>
                      </table>  
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
        </div>

        
    </body>

    
     
    <script>
        

        var selectedCompanies = []
        var total_companies_names = []
        var global_similar_data = [];
        var $fdataTable;
        var contact_info_data = [];
        var defaultTextAreaData = {
            "active":{
                "opearting_years":{"default":"+20","updated":""},
                "employees":{"default":"+5000", "updated":""},
                "growth_quarterly":{"default":"+5%","updated":""},
                "growth_yearly":{"default":"+5%","updated":""},
            },
            "inactive":{
                "opearting_years":{"default":"-15","updated":""},
                "employees":{"default":"-1000","updated":""},
                "growth_quarterly":{"default":"-2%","updated":""},
                "growth_yearly":{"default":"-2%","updated":""}
            }
        }
        let timer;
        
        var filterData = {
            "industry":[],
            "headquarters":[]
        }
        var comparision_filters = {
            "between":"Between",
            "gt":"Greater Than",
            "lt":"Less Than",
            "et":"Equal To",
            "gtet":"Greater Than Equal To",
            "ltet":"Less Than Equal To"
        }

        $( document ).ready(function() {

            $contacts_table = $('#contacts_table').DataTable({
                "iDisplayLength" : 10,
                "responsive":true,
                "bAutoWidth": false,
                "serverSide": false,
                "processing": false,
                "ordering": false,
               
            });
           
            getEvents();

            $('[data-toggle="tooltip"]').tooltip()

            $('.top_row_input_panel').click(function(){
                let name = $(this).attr('data-name')
                
                if(name=="query"){
                    if($(this).hasClass('active')){
                        $('.input_panel').addClass('d-none')
                        $(this).removeClass('active') 
                    }else{
                        $('.input_panel').removeClass('d-none')
                        $(this).addClass('active') 
                    }
                }
                if(name=="filter"){
                    if($(this).hasClass('active')){
                        $('.filters_sections').addClass('d-none')
                        $(this).removeClass('active') 
                    }else{
                        $('.filters_sections').removeClass('d-none')
                        $(this).addClass('active') 
                    }
                }
                 
                 
            })

            for(const key in comparision_filters){
                $('#no_of_employees_filter, #quarterly_growth_filter, #annual_growth_filter, #operating_years_filter').append(`<option value="${key}">${comparision_filters[key]}</option>`)     
            }
             
            $('#industry_filter').select2({
                placeholder: 'Select Industry',
                allowClear:true,
            });
            $('#headquarters_filter').select2({
                placeholder: 'Select Headquarters',
                allowClear:true,
            });


            $('.basic_text_ui').find('input').keypress(function(e) {
                var a = [43, 45];
               
                //allow % sign for some fields
                let input_name =   $(this).attr('name');
                let input_value =   $.trim($(this).val());
                 
                if(input_name.includes('growth_quarterly') || input_name.includes('growth_yearly')){
                    a.push(37);
                    a.push(46);
                }
                if(input_name.includes('opearting_years')){
                    a.push(46);
                }
                
                
                var k = e.which;
                 
                for (i = 48; i < 58; i++)
                    a.push(i);
                
                if (!($.inArray(k,a)>=0))
                    e.preventDefault();
            })

            //populate default values in input
            $('.basic_text_ui').find('input').each(function(){
                let input_name =   $(this).attr('name');
                var input_value = $(this).val();
                if(input_name.includes('act_')){
                   let field_name = input_name.split('act_');
                   $(this).val(defaultTextAreaData['active'][field_name[1]]['default'])
                }else{
                    let field_name = input_name.split('int_');
                    $(this).val(defaultTextAreaData['inactive'][field_name[1]]['default'])
                }
            })
            
            $('.toggle_uid span').click(function(){
                let tabvalue = $(this).data('tab')
                $('.toggle_uid span').removeClass('active')
                $(this).addClass('active')
                if(tabvalue=="advance"){
                    $('.advance_text_ui').removeClass('d-none')
                    $('.basic_text_ui').addClass('d-none')
                }else{
                    $('.advance_text_ui').addClass('d-none')
                    $('.basic_text_ui').removeClass('d-none')
                }
            })

            $(document).on('change input',".basic_text_ui input", function(){
                let input_name =   $(this).attr('name');
                var input_value = $.trim($(this).val());
                var is_valid = true;
                //validation add red border
                if(input_value==""){
                    is_valid = false
                }

                //apply validation rules here
                if(is_valid){
                    let extrt_val = input_value.slice(0, 1);
                    let second_character = input_value.slice(1, 2);
                    
                    if(extrt_val!="+"  && extrt_val!="-"){
                        is_valid = false  
                    }
                    if(/^\d+$/.test(second_character) == false){
                        is_valid = false  
                    }
                    if(input_value.split('+').length > 2){
                        is_valid = false  
                    }
                    if(second_character <= 0){
                        is_valid = false
                    }
                    if(input_value.includes('-') && input_value.includes('+')){
                        is_valid = false  
                    }          
                }
                if(input_name.includes('growth_quarterly') || input_name.includes('growth_yearly')){
                    if(is_valid){
                        if(input_value.split('%').length > 2){       
                            is_valid = false    
                        }
                        var get_value = input_value.replace(/\D/g, "");
                        if(get_value > 100){
                            is_valid = false      
                        }    
                        if(!input_value.includes('%')){
                            is_valid = false      
                        }
                    }   
                }
                 
                if(is_valid){
                    $(this).removeClass('alert_blank')   
                }else{
                    $(this).addClass('alert_blank')   
                }

 
                if(is_valid){
                    if(input_name.includes('act_')){
                        let field_name = input_name.split('act_');
                        defaultTextAreaData['active'][field_name[1]]['updated'] = input_value
                    }else{
                        let field_name = input_name.split('int_');
                        defaultTextAreaData['inactive'][field_name[1]]['updated'] = input_value
                    }
                    setTextAreaValue()
                }            
            })
 
           
            setTextAreaValue()

            $('.select_code_list').select2({
                placeholder: 'Search Codes',
                minimumInputLength: 1,
                allowClear:true,
                ajax: {
                    delay:250,
                    type: "POST",
                    url: graphQLEndpoint,
                    dataType: 'json',
                    contentType: "application/json",
                    data: function (params) {
                        let fieldinput = '';
                        var fieldkey = $('input[name="business_codes"]:checked').val();
                        if(fieldkey=="sic_code"){
                            fieldinput = "SIC"
                        }else if(fieldkey=="naics_code"){
                            fieldinput = "NAICS"
                        }
                        var query = 
                        {
                            query: "query callRedisEnpoints($method: String!,$input: JSON ){\r\n    callRedisEnpoints(method:$method,input:$input){\r\n         records\r\n    }\r\n}",
                            variables: {
                                method: "get-name-suggestion",
                                input: {
                                    value: params.term,
                                    field: fieldinput
                                }
                            }
                        }
                        return JSON.stringify(query);
                    },
                    processResults: function (data) {
                        data = data.data.callRedisEnpoints.records
                        // Transforms the top-level key of the response object from 'items' to 'results'
                        var tmparr = []
                        if(data.length > 0){
                            for(let key in data){
                                tmparr.push({"text":data[key], "id": data[key] })
                            }
                        }
                        return {
                          results: tmparr
                        };
                    }
                    
                }
            });

             

            $('.select2_company_list').select2({
                tags: true,
                placeholder: 'Search Companies By Name',
                minimumInputLength: 1,
                allowClear:true,
                ajax: {
                    delay:250,
                    type: "POST",
                    url: graphQLEndpoint,
                    dataType: 'json',
                    contentType: "application/json",
                    data: function (params) {
                        var query = {
                            query: "query callRedisEnpoints($method: String!,$input: JSON ){\r\n    callRedisEnpoints(method:$method,input:$input){\r\n         records\r\n    }\r\n}",
                            variables: {
                                method: "get-name-suggestion",
                                input: {
                                    value: params.term,
                                    field: "name"
                                }
                            }
                        }
                        // Query parameters will be ?search=[term]&type=public
                        return JSON.stringify(query);
                    },
                    processResults: function (data) {
                        data = data.data.callRedisEnpoints.records
                        // Transforms the top-level key of the response object from 'items' to 'results'
                        var tmparr = []
                        if(data.length > 0){
                            for(let key in data){
                                tmparr.push({"text":data[key], "id": data[key] })
                            }
                        }
                        return {
                          results: tmparr
                        };
                    }
                    
                }
            });

            $('.select2_company_list').on("select2:select", function(e) { 
               //$('.select2_company_list').select2('data', null)
            });


            $('#query')[0].focus();
            
            $fdataTable = $('#outputtable').DataTable({
                "iDisplayLength" : 10,
                "responsive":true,
                "bAutoWidth": false,
                "serverSide": false,
                "processing": false,
                "ordering": false,
                "drawCallback": function( settings ) {
                    $("td:contains('ACTIVE')").css('color', 'green');
                    $("td:contains('INACTIVE')").css('color', 'red');
                    $("td:contains('OTHERS')").css('color', '#be6211'); 
                    
                    
                }
            });

            $('#submitbutton').click(function(){
                $('.cmnbtn').hide();
                $('.output_results').find('tbody_class').html('');
                $('#sbtext').hide();
                $('.error_msg').hide();
                $(this).find('.spinner-border').show();
                
                //request payload
                var requestPayload = {
                    query : $('#query').val(),
                    company_list: [],
                    //source: [],
                    case_type: "classify",
                    codes:{"sic_code":"",'naics_code':""},
                    events:[]
                }  

                //add events
                $('.event_item_input').each(function(i,item){
                    if($(item).is(':checked')){
                        let split_uri = $(item).val().split('http://event.org/event/')[1]
                        split_uri = split_uri.toLowerCase()
                        split_uri = split_uri.replace(/[^\w\s]/gi, '')
                        
                        requestPayload['events'].push(split_uri)
                    }
                })

                var $companylist = $('#company_list').val();
                if($companylist.length > 0){
                    requestPayload['company_list'] = $companylist;
                }
                
                let codeValue = $('.select_code_list').val()
                //check sic and nic code
                $codes = $('input[name="business_codes"]:checked').val() 
                if($codes=="naics_code"){
                    requestPayload['codes']['naics_code'] = codeValue
                }else if($codes=="sic_code"){
                    requestPayload['codes']['sic_code'] = codeValue
                }

                getResults(requestPayload)
            })
   
            
            $('input[name="business_codes"]').change(function(){
                $('.select_code_list').empty();
                var val = $(this).val();
                if(['sic_code','naics_code'].includes(val)){
                    $('.company_code_box').removeClass('d-none')
                }else{
                    $('.company_code_box').addClass('d-none')
                }
            })

            $(document).on('select2:open', function(e){
               document.querySelector('.select2-search__field').focus();
            });

           
            $('.showkg_Button').click(function(e){
                
                if(selectedCompanies.length > 0){
                    let tmpArr = [];
                    for(let i = 0; i < selectedCompanies.length; i++){
                        tmpArr.push({"name":$.trim(selectedCompanies[i])})   
                    }
                    let events = [];
                    $('.event_item_input').each((index, item)=>{
                        if($(item).is(':checked')){
                            events.push($(item).val())
                        }
                    })
                    showKgIframe({"company_list":tmpArr,'event':events});
                }                
            })


            $(document).on('keyup','.num_validate',function(){
                let $this = $(this)
                clearTimeout(timer);
                timer = setTimeout(() => {
                    /*let isBetween  = $($this).parents('.input_between').length
                    if(isBetween){
                        let from  = $($this).parents('.input_between').find('.from_num').val();
                        let to  = $($this).parents('.input_between').find('.to_num').val();
                        if(from=="" || to==""){
                            return false
                        }
                    }
                    filterFunction() */
                    filterFunction()
                },800)
            })

            $(document).on('change','.filter_selectbox',function(){
              
                let name = $(this).attr('data-name')
                
                if(name=='no_of_employees' || name=='quarterly_growth' || name=='annual_growth' || name=='operating_years'){
                    
                    $(this).parents('.comp_box').find('input').val('');
                    $(this).parents('.comp_box').find('.input_between').addClass('d-none')
                    $(this).parents('.comp_box').find('.input_single').addClass('d-none')
                    let value = $(this).val() 
                    if(value!=""){
                        if(value=="between"){
                            $(this).parents('.comp_box').find('.input_between').removeClass('d-none')
                            $(this).parents('.comp_box').find('.input_between').find('input:first').focus()
                        }else{
                            $(this).parents('.comp_box').find('.input_single').removeClass('d-none')
                            $(this).parents('.comp_box').find('.input_single').find('input').focus()
                        }
                    }
                    //return false;
                }
                 
                filterFunction()           
            })

            $('.clear_filter').click(function(){
                
                $('.input_between').addClass('d-none')
                $('.input_single ').addClass('d-none')
                 
                $('.filter_selectbox').val(null).trigger("change");
                $('.select2-selection__clear').remove();
                 
                $('.filters_sections').find('input').val('')    
                $fdataTable.clear();
                total_companies_names = [] 
                $.each(global_similar_data, function(i, item) {
                    total_companies_names.push(item.name)
                    InsertDataTable(item);
                });
                $fdataTable.draw(true).columns.adjust().responsive.recalc();

                $('.chk_all_boxes').prop('checked', false)
                setCompaniesSelection()

                
            })

            $('.filter_selectbox').on('select2:open', function (e) {
                if($(this).find('option:first').text()=="Select"){
                    $(this).find('option:first').remove()
                }
            });

            $(document).on('change','.chk_input_ticker',function(){
                if(!$(this).is(':checked')){
                    $('.chk_all_boxes').prop("checked", false)
                }
                setCompaniesSelection();               
            })

            $('.chk_all_boxes').change(function(){
                let status =  false;
                if($('.chk_all_boxes').is(':checked')){
                    status = true; 
                }
                $fdataTable.rows().nodes().each(function (item) { 
                    $(item).find('input[type="checkbox"]').prop("checked", status)
                });
                
                setCompaniesSelection();
            })


            $(document).on('click','.view_cnt_redis', function(){
                let companyname = $(this).attr('data-id')
                var settings = {
                    "url": graphQLEndpoint,
                    "method": "POST",
                    "timeout": 0,
                    "headers": {
                      "Content-Type": "application/json"
                    },
                    "data": JSON.stringify({
                      query: "query GetContactsFromGraphDB($company: String!){\r\n        GetContactsFromGraphDB(company: $company){\r\n          records\r\n        }\r\n}",
                      variables: {"company":companyname}
                    })
                  };
                  
                $.ajax(settings).done(function (response) {
                    let i = 1;
                    $contacts_table.clear();
                    $('.contact_body').html('');
                    response.data.GetContactsFromGraphDB.records.forEach((info)=>{
                        $contacts_table.row.add([i, info['first_name'], info['last_name'], info['source'], info['occupation'], info['description'], info['social_url']!=""?`<a target="_blank" href="${info['social_url']}">${info['social_url']}</a>`:""]);
                        i++;
                    })
                    $contacts_table.draw(true).columns.adjust().responsive.recalc();
                    $('.pop_info_comp').text(companyname);
                    $('#contactViewModal').modal({backdrop: 'static', keyboard: false}, 'show');
                });
            })

        });
    function getResults(payload){
        showkgbuttonMode(0)
        var settings = {
            "url": graphQLEndpoint,
            "method": "POST",
            "timeout": 0,
            "headers": {
            "Content-Type": "application/json"
            },
            "data": JSON.stringify({
            query: "query getCompaniesByStatus($company_list: [String!], $query: String!, $case_type:String!, $codes: CodesCategory, $events:[String])\r\n{\r\n    getCompaniesByStatus(company_list: $company_list, query: $query, case_type:$case_type, codes: $codes, events:$events)\r\n    {\r\n   id\r\n     name\r\n        industry\r\n        status\r\n   operating_years\r\n no_of_employees\r\n annual_growth\r\n quarterly_growth\r\n headquarters\r\n } \r\n}",
            variables: payload
            })
        };
        
        $.ajax(settings).done(function (response) {
            $('#sbtext').show();
            $('#submitbutton').find('.spinner-border').hide();
            if(response.errors){
                $('.output_results').hide()
                $('.error_msg').show();
            }
            
            if(response.data.getCompaniesByStatus.length){
                $('.filters_sections').removeClass('d-none')
                $('.top_row_input_panel[data-name="filter"]').addClass('active').removeClass('d-none')
                $('.top_row_input_panel[data-name="query"]').removeClass('active')
                $('.input_panel').addClass('d-none')
                $('.cmnbtn').show();
                $fdataTable.clear();           
                global_similar_data = response.data.getCompaniesByStatus;
                
                $('.output_results').show()
                $('.tbody_class').html('')
                $('#get_visual_graph').show()
                let industryValues = []
                let headValues = []
                total_companies_names = []
                filterData = {
                    "industry":[],
                    "headquarters":[]
                }
                $.each(response.data.getCompaniesByStatus, function(i, item) {
                    
                    total_companies_names.push(item.name)
                    InsertDataTable(item)
                    
                    
                    //add data in temp variables for filter
                    if(item.industry!="" && item.industry!=null){
                        let industryTemp = item.industry.split(',') 
                        industryValues.push(...industryTemp)
                    }
                    headValues.push(...[item.headquarters])

                });
                
            
                $fdataTable.draw(false).columns.adjust().responsive.recalc();

                //fill values in filters inputs
                filterData['industry'].push(...industryValues)
                filterData['headquarters'].push(...headValues)
                addValuesInFilterInputs(filterData)
                            
            }else{
                global_similar_data = [];
                $('.output_results').hide()
                $('.error_msg').show();
                $('.filters_sections').addClass('d-none')
            }
        });
    }
    
         
    function checkBtnStaus(){
        var query = $.trim($('#query').val())
        //var company_list   = $('#company_list').val();
        //var sources   = $('input[name^="sources"]:checked').length
            
        if(query!=""){
            $('#submitbutton').attr('disabled', false)
        }else{
            $('#submitbutton').attr('disabled', true)
        }
    }

        
    function setTextAreaValue(){

var defaulttext =  `ACTIVE:
${defaultTextAreaData.active.opearting_years.updated!=""?defaultTextAreaData.active.opearting_years.updated:defaultTextAreaData.active.opearting_years.default} years of operating business
${defaultTextAreaData.active.employees.updated!=""?defaultTextAreaData.active.employees.updated:defaultTextAreaData.active.employees.default} employees
${defaultTextAreaData.active.growth_quarterly.updated!=""?defaultTextAreaData.active.growth_quarterly.updated:defaultTextAreaData.active.growth_quarterly.default} growth quarterly
${defaultTextAreaData.active.growth_yearly.updated!=""?defaultTextAreaData.active.growth_yearly.updated:defaultTextAreaData.active.growth_yearly.default} growth yearly
            
INACTIVE:
${defaultTextAreaData.inactive.opearting_years.updated!=""?defaultTextAreaData.inactive.opearting_years.updated:defaultTextAreaData.inactive.opearting_years.default} year operating business
${defaultTextAreaData.inactive.employees.updated!=""?defaultTextAreaData.inactive.employees.updated:defaultTextAreaData.inactive.employees.default} employees
${defaultTextAreaData.inactive.growth_quarterly.updated!=""?defaultTextAreaData.inactive.growth_quarterly.updated:defaultTextAreaData.inactive.growth_quarterly.default} growth quarterly
${defaultTextAreaData.inactive.growth_yearly.updated!=""?defaultTextAreaData.inactive.growth_yearly.updated:defaultTextAreaData.inactive.growth_yearly.default} growth yearly

OTHERS:
Any other leads which are not Active or Inactive`
        $('#query').val(defaulttext)
        
}

    function showKgIframe(payload){
        var settings = {
            "url": graphQLEndpoint,
            "method": "POST",
            "timeout": 0,
            "headers": {
            "Content-Type": "application/json"
            },
            "data": JSON.stringify({
            query: "query showGraphDbKg($company_list: [ShowkgRequest!], $event:[JSON])\r\n{\r\n    showGraphDbKg(company_list: $company_list, event: $event)\r\n    {\r\n        graph_url\r\n    } \r\n}",
            variables: payload
            })
        };
        
        $.ajax(settings).done(function (response) {
            if(response.data.showGraphDbKg.length){
                var graph_url = response.data.showGraphDbKg[0].graph_url
                window. open(visualGraphShowKG(graph_url, "full"));
                
            }
        });
    }

   
    function addValuesInFilterInputs(data){
            
        //remove duplicates values
        for (const key in data) {
            var unique = data[key].filter(onlyUnique);
            data[key] = unique;
        }

        for (const key in data) {
            $('#'+key+"_filter").empty().append('<option value="">Select</option>')
            for(let i =0 ; i  < data[key].length; i++){
                $('#'+key+"_filter").append(`<option value="${data[key][i]}">${data[key][i]}</option>`)
            }   
        }
    }

    function onlyUnique(value, index, array) {
        return array.indexOf(value) === index;
    }

    function filterFunction(){
        let records = global_similar_data;
        let filterRecords = records.filter(function(value, index){
            let type = false;
            let totalNonEmptyField = []
            let totalMatched = []
           
            $('.filters_sections').find('.filter_selectbox').each(function(index1, item){
               
                let itemValue = $(item).val()
                let name = $(item).attr('data-name')
              
                let isComparison = false;
                if(name=='no_of_employees' || name=='quarterly_growth' || name=='annual_growth' || name=='operating_years'){
                    isComparison = true 
                }
                //let isComparison =  ['no_of_employees','quarterly_growth','annual_growth','opearting_years'].includes(name)
                if(itemValue.length > 0 || isComparison || name=="status"){
                    let isStatus = false;
                    if(isComparison){
                        let singleInputValue = "";
                        let fromInputValue = "";
                        let toInputValue = "";
                        if(itemValue=="between"){
                            fromInputValue  = $(item).parents('.comp_box').find('.from_num').val() 
                            toInputValue  = $(item).parents('.comp_box').find('.to_num').val()
                        }else{
                            singleInputValue = $(item).parents('.comp_box').find('.input_single').find('input').val() 
                        }

                        if(singleInputValue!="" || (fromInputValue!="" && toInputValue!="")){
                            console.log(singleInputValue)
                            totalNonEmptyField.push(index1)
                            if(value[name]!=""){
                                value[name] = parseFloat(value[name])
                            }
                            if((fromInputValue!="" && toInputValue!="")){
                                fromInputValue = parseFloat(fromInputValue) 
                                toInputValue = parseFloat(toInputValue) 
                            }
                            switch(itemValue){
                                case "between":
                                    if(value[name] >= fromInputValue && value[name] <= toInputValue){
                                            isStatus = true;    
                                    } 
                                break;
                                case "gt":
                                    if(value[name] > singleInputValue){
                                        isStatus = true;    
                                    }
                                break;
                                case "lt":
                                    if(value[name] < singleInputValue){
                                        isStatus = true;    
                                    }
                                break;
                                case "et":
                                    console.log(value[name])
                                    console.log(singleInputValue);
                                    if(value[name] == singleInputValue){
                                        isStatus = true;    
                                    }
                                break;
                                case "gtet":
                                    if(value[name] >= singleInputValue){
                                        isStatus = true;    
                                    }
                                break;
                                case "ltet":
                                    if(value[name] <= singleInputValue){
                                        isStatus = true;    
                                    }
                                break;
                            }
                        }
                    } 
                    else if(name=="status"){
                         
                        if(itemValue!=""){
                            totalNonEmptyField.push(index1)
                            if(value[name] == itemValue){
                                 
                                isStatus = true;    
                            }
                        }

                    }else{  
                        totalNonEmptyField.push(index1)
                        for(let k = 0; k < itemValue.length; k++){
                            if(typeof(value[name]) =="string"){
                                if(value[name].includes(itemValue[k])){
                                    isStatus = true;    
                                }
                            }
                            
                        }
                    }
                    if(isStatus){
                        totalMatched.push(index1)
                    }
                }
            })
            if(totalNonEmptyField.length == totalMatched.length){
                type = true
            }
            return type;
        })

        
        $fdataTable.clear();
        total_companies_names = []
        $.each(filterRecords, function(i, item) {
            total_companies_names.push(item.name)
            InsertDataTable(item);
        });
        $fdataTable.draw(true).columns.adjust().responsive.recalc();

        $('.chk_all_boxes').prop('checked', false)
        setCompaniesSelection()
    }

    
    function InsertDataTable(item){
        let inputCheckbox  = '<input type="checkbox" class="chk_input_ticker" data-chkname="'+item.name+'">'
        contact = `<button class="btn btn-xs btn-primary view_cnt_redis " data-id="${item.name}">View</button>`;
        $fdataTable.row.add(["", inputCheckbox, item.name, item.industry, item.headquarters, item.status, contact, item.operating_years, item.no_of_employees, item.quarterly_growth, item.annual_growth]);
    }


    function showkgbuttonMode(status){
        if(status){
            $('.showkg_Button').removeAttr('disabled')
            $('.showkg_Button').removeAttr('data-toggle')
            $('.showkg_Button').removeAttr('title')
            $('.showkg_Button').removeAttr('data-original-title')
            $('[data-toggle="tooltip"]').tooltip()
        }else{
            $('.showkg_Button').attr('disabled', true)
            $('.showkg_Button').attr('data-toggle',"tooltip")
            $('.showkg_Button').attr('title', "Please select companies")
            $('.showkg_Button').attr('data-original-title', "Please select companies")
            $('[data-toggle="tooltip"]').tooltip()
        }
    }

    function setCompaniesSelection(){
        selectedCompanies = []
        
        if($('.chk_all_boxes').is(':checked')){
            selectedCompanies = total_companies_names;
        }else{
            if(total_companies_names.length > 0){
                $fdataTable.rows().nodes().each(function (item) { 
                    if($(item).find('input[type="checkbox"]').is(":checked")){
                        selectedCompanies.push($(item).find('input[type="checkbox"]').attr('data-chkname'));      
                    }
                });
            }
        }        

        if(total_companies_names.length > 0){
            if(total_companies_names.length == selectedCompanies.length){
                $('.chk_all_boxes').prop('checked',true);
            }else{
                $('.chk_all_boxes').prop('checked',false);
            }
        }
        
        if(selectedCompanies.length > 0){
            showkgbuttonMode(1)
        }else{
            showkgbuttonMode(0)
        }
    }

    function getEvents(){
        var settings = {
            "url": graphQLEndpoint,
            "method": "POST",
            "timeout": 0,
            "headers": {
              "Content-Type": "application/json"
            },
            "data": JSON.stringify({
              query: "query getAllEvents {\r\n     getAllEvents \r\n}\r\n",
              variables: {}
            })
          };
          
          $.ajax(settings).done(function (response) {
            if(response.data.getAllEvents.length  > 0){
                $('#events_wrapper').show();
            }else{
                $('#events_wrapper').hide();
            }
            response.data.getAllEvents.forEach(function(item, i){
                $('#events_item_block').append(`
                    <div class="form-group">
                        <div class="custom-control custom-checkbox custom-control-inline">
                            <input type="checkbox" id="customRadio${i}" name="events[]" class="custom-control-input event_item_input" value="${item.uri}">
                            <label class="custom-control-label" for="customRadio${i}">${item.name}</label>
                        </div>
                    </div> 
                `)
            })
            
          });   
    }

    </script>
</html>
